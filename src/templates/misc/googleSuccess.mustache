<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
            <meta content="text/html; charset=UTF-8" name="Content-Type"/>
            <meta content="width=device-width, initial-scale=1" name="viewport">
                <meta content="458867-3eb18e63-beef-4f85-907f-046732aaec99" name="OMG-Verify-V1"/>
                <title>
                    MailTag
                </title>
                <script src="/lib/jquery/dist/jquery.min.js">
                </script>
                <script src="/lib/jqueryui/jquery-ui.min.js">
                </script>
                <script src="/lib/bootstrap/dist/js/material.min.js">
                </script>
                <script src="/lib/bootstrap/dist/js/bootstrap.min.js">
                </script>
                <script src="/lib/mustache/mustache.min.js" type="text/javascript">
                </script>
                <script src="/lib/bootstrap/dist/js/bootstrap.min.js">
                </script>
                <script src="/js/bootstrap-dialog.min.js">
                </script>
                <script src="/js/config.js">
                </script>
                <!-- <script id="profitwell-js" data-pw-auth="800982233c7362be92984f6363f547c1">
                (function(i,s,o,g,r,a,m){i[o]=i[o]||function(){(i[o].q=i[o].q||[]).push(arguments)};
                a=s.createElement(g);m=s.getElementsByTagName(g)[0];a.async=1;a.src=r+'?auth='+
                s.getElementById(o+'-js').getAttribute('data-pw-auth');m.parentNode.insertBefore(a,m);
                })(window,document,'profitwell','script','https://public.profitwell.com/js/profitwell.js');
                var currentUser = common.getUserDataFromCookie();
                if (currentUser['email']){
                    profitwell('start', {'user_email': currentUser['email']});
                }
                else{
                    profitwell('start', {});
                }
                
                </script> -->
                <script>
                    function growsumoInit() {
                        console.log("growsumoInit before try");
                        try{
                            growsumo.data.customer_key = $('#user_id').attr('value');
                            growsumo.data.email = $('#user_email').attr('value');
                            growsumo.data.name = $('#user_name').attr('value');
                            analytics('mailtag-enabled', growsumo.data.email);
                            if ($('#isNewUser').attr('value') === "true") {
                                var promise = analytics('signup', growsumo.data.email);
                                promise.then(function() {
                                    growsumo.createSignup(function() {
                                        window.close();
                                    });
                                });
                            } else {
                                var promise = analytics('login', growsumo.data.email);
                                promise.then(function() {
                                    window.close();
                                });
                            }
                        }catch(e){
                            console.log("catch ",e);
                            window.close();
                        }
                        
                    }
                    function analytics(eventName, emailAddress) {
                        var eventData = {
                            'email_address': emailAddress
                        };
                        console.log("Event data ",eventData);
                        var promise=$.ajax({
                            type: "POST",
                            url: config.baseURL + 'segment-analytics',
                            data: JSON.stringify({
                                "eventName": eventName,
                                "eventData": eventData
                            }),
                            async: true,
                            success: function(data, status, xhr) {
                                console.log(data, status, xhr);
                            },
                            dataType: "json"
                        });
                        return promise;
                    }
                </script>
                <script type="text/javascript">
                    (function() {var gs = document.createElement('script');gs.src = 'https://snippet.growsumo.com/growsumo.min.js';gs.type = 'text/javascript';gs.async = 'true';gs.onload = gs.onreadystatechange = function() {var rs = this.readyState;if (rs && rs != 'complete' && rs != 'loaded') return;try {growsumo._initialize('pk_aCB6kfOvrCGy8KfGmsurK1sbWh5DMeLn');if (typeof(growsumoInit) === 'function') {growsumoInit();}} catch (e) {}};var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gs, s);})();
                </script>
            </meta>
        </meta>
    </head>
    <body>
        <div class="container">
            <div class="row">
            </div>
            <div class="row" style="display: none;">
                <label id="user_id" value="{{user_id}}">
                    {{user_id}}
                </label>
                <label id="user_email" value="{{user_email}}">
                    {{user_email}}
                </label>
                <label id="user_name" value="{{user_name}}">
                    {{userName}}
                </label>
                <label id="isNewUser" value="{{isNewUser}}">
                    {{isNewUser}}
                </label>
            </div>
        </div>
    </body>
    <script src="/js/mixpanel.js">
    </script>
    <script>
        function getCookie(cookieName) {
            var name = cookieName + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for(var i = 0; i <ca.length; i++) {
             var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            if (cookieName==='referral') {
                return "No Referral";
            }if (cookieName==='tag'){
                return "No tag";
            } 
        }
        var referral_id = getCookie('referral');
        var tag_id = getCookie('tag');
        mixpanel.track("New user created", {
            "email_id": $('#user_email').attr('value'),
            "user_id": $('#user_id').attr('value'),
            "referral_id": referral_id,
            "tag_id": tag_id
        });
        // setTimeout(function(){
        //     growsumo.data.customer_key = $('#user_id').attr('value');
        //     growsumo.data.email = $('#user_email').attr('value');
        //     growsumo.data.name = $('#user_name').attr('value');
        //     console.log("isNewUser => ",$('#user_id').attr('value'));
        //     if ($('#isNewUser').attr('value') === "true") {
        //         growsumo.createSignup(function () {
        //             window.close();
        //         });
        //     } else {
        //         window.close();
        //     }
        // },500);
        setTimeout(function () {
            window.close();
        }, 5000);
    </script>
</html>